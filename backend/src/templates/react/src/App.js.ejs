import React, { useState, useEffect } from 'react';
import axios from 'axios';
import './App.css';

function App() {
  const [message, setMessage] = useState('Loading...');
  const [error, setError] = useState(null);

  useEffect(() => {
    // Check if API backend is connected
    <% const apiService = dependencies.find(d => ['node', 'python-flask', 'python-fastapi'].includes(d.type)); %>
    <% if (apiService) { %>
    const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:<%= apiService.config?.port || 5000 %>';
    
    axios.get(`${apiUrl}/health`)
      .then(response => {
        setMessage('Connected to API: ' + JSON.stringify(response.data));
      })
      .catch(err => {
        setError('Failed to connect to API: ' + err.message);
      });
    <% } else { %>
    setMessage('No API backend configured');
    <% } %>
  }, []);

  return (
    <div className="App">
      <header className="App-header">
        <h1><%= service.label %></h1>
        <p>Generated by Kontrol ðŸš€</p>
        
        <div className="status-box">
          {error ? (
            <div className="error">{error}</div>
          ) : (
            <div className="success">{message}</div>
          )}
        </div>

        <div className="info">
          <h2>Services Connected:</h2>
          <ul>
            <% dependencies.forEach(dep => { %>
            <li><%= dep.label %> (<%= dep.type %>)</li>
            <% }); %>
            <% if (dependencies.length === 0) { %>
            <li>No dependencies configured</li>
            <% } %>
          </ul>
        </div>
      </header>
    </div>
  );
}

export default App;
